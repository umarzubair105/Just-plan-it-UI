<div class="container-lg mt-0 px-0">
  <div class="col-md-12 offset-md-0">
    <div class="card">
      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
        <h4 class="mb-0"><i class="bi bi-tree me-2"></i> {{ resource!.name }}'s Leaves</h4>
        <button (click)="closeDialog()" class="btn btn-sm text-white">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <div class="card-body">

        <div class="text-end mb-2">
          <button (click)="openModal(editLeave)"
                  class="btn btn-sm me-2"
                  title="Add new resource">
            <i class="bi bi-plus"></i> Add New Leave
          </button>
        </div>
        <div class="table-responsive">
          <table class="table table-striped table-hover table-bordered table-sm-custom text-sm">
            <thead class="table-secondary">

            <tr>
              <th>Type</th>
              <th>Reason</th>
              <th>Status</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Approved At</th>
              <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let row of leaves;">
              <td>{{ row.leaveType.toString() | prettyLabel }}</td>
              <td>{{ row.reason }}</td>
              <td>{{ row.status.toString() | prettyLabel }}</td>
              <td>{{ row.startDate }}</td>
              <td>{{ row.endDate }}</td>
              <td>{{ row.approvedAt | formatDate }}</td>
              <td class="text-center">
                <a (click)="openModalEdit(editLeave, row.id)" title="Update">
                  <i class="bi bi-pencil me-2"></i>
                </a>
                <a (click)="delete(row.id)" title="Delete">
                  <i class="bi bi-trash me-2"></i>
                </a>
                <a (click)="updateStatus(row.id, LeaveStatus.APPROVED)" *ngIf="row.status===LeaveStatus.PENDING && resourceId!==loggedUserId"
                   title="Approve">
                  <i class="bi bi-hand-thumbs-up me-2"></i>
                </a>
                <a (click)="updateStatus(row.id, LeaveStatus.REJECTED)" *ngIf="row.status===LeaveStatus.PENDING  && resourceId!==loggedUserId"
                   title="Reject">
                  <i class="bi bi-hand-thumbs-down me-2"></i>
                </a>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <ng-template #editLeave>
      <div class="modal fade show d-block">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header text-white justify-content-between align-items-center py-2 px-3 ">
              <h5 class="modal-title mb-0 fx-6">Add/Update Leave</h5>
              <button (click)="closeModal()" class="btn btn-sm text-white p-0">
                <i class="bi bi-x-lg"></i>
              </button>
            </div>
            <div class="modal-body">
              <form #resourceForm="ngForm">
                <div class="mb-2">
                  <label class="form-label">Type<span class="text-danger ms-1">*</span></label>
                  <select #leaveType="ngModel" [(ngModel)]="leave.leaveType" [ngClass]="{ 'is-invalid': leaveType.invalid && (leaveType.dirty || leaveType.touched) }" [showErrors]="{ required: 'Type is required' }"
                          class="form-control"
                          name="leaveType"
                          required>
                    <option *ngFor="let scope of leaveTypes" [value]="scope.viewValue">
                      {{ scope.value }}
                    </option>
                  </select>
                </div>
                <div class="mb-2">
                  <label class="form-label">Reason<span class="text-danger ms-1">*</span></label>
                  <textarea #reason="ngModel" [(ngModel)]="leave.reason" [ngClass]="{ 'is-invalid': reason.invalid && (reason.dirty || reason.touched) }" [showErrors]="{ required: 'Reason is required' }" class="form-control"
                            name="reason"
                            required
                            rows="5"
                            type="text">
                  </textarea>
                </div>
                <div *ngIf="leave.id>0 && leave.resourceId != loggedUserId" class="mb-2">
                  <label class="form-label">Status<span class="text-danger ms-1">*</span></label>
                  <select #status="ngModel" [(ngModel)]="leave.status" [ngClass]="{ 'is-invalid': status.invalid && (status.dirty || status.touched) }" [showErrors]="{ required: 'Status is required' }"
                          class="form-control"
                          name="status"
                          required>
                    <option *ngFor="let scope of leaveStatuses" [value]="scope.viewValue">
                      {{ scope.value }}
                    </option>
                  </select>
                </div>
                <div class="mb-2">
                  <label class="form-label">Start Date<span class="text-danger ms-1">*</span></label>
                  <input #startDate="ngModel" [(ngModel)]="leave.startDate" [min]="getToDayDate()" [ngClass]="{ 'is-invalid': startDate.invalid && (startDate.dirty || startDate.touched) }" [showErrors]="{ required: 'Start Date is required' }"
                         class="form-control"
                         name="startDate"
                         required
                         type="date">
                </div>
                <div class="mb-2">
                  <label class="form-label">End Date<span class="text-danger ms-1">*</span></label>
                  <input #endDate="ngModel" [(ngModel)]="leave.endDate" [min]="leave.startDate?leave.startDate:getToDayDate()" [ngClass]="{ 'is-invalid': endDate.invalid && (endDate.dirty || endDate.touched) }" [showErrors]="{ required: 'End Date is required' }"
                         class="form-control"
                         name="endDate"
                         required
                         type="date">
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button (click)="update()" *ngIf="leave.id>0" [disabled]="resourceForm.invalid"
                      class="btn btn-primary w-20">Save
              </button>
              <button (click)="add()" *ngIf="leave.id===0" [disabled]="resourceForm.invalid"
                      class="btn btn-primary w-20">Save
              </button>
              <button (click)="closeModal()" class="btn btn-secondary w-20">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
  </div>
