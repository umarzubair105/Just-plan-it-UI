<div class="container-lg mt-4">
  <div class="row">
    <div class="col-md-12 offset-md-0">

      <div class="card shadow-lg">
        <div class="card-header bg-primary text-white text-center">
          <h2 class="h4 mb-0">Leaves for {{resource!.name}}</h2>
        </div>
        <div class="container mt-2">
          <div class="table-responsive">
            <table class="table table-striped table-hover table-bordered table-sm-custom text-sm">
              <thead class="table-secondary" >

              <tr>
                <th>Type</th>
                <th>Reason</th>
                <th>Status</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Approved At</th>
                <th>Action</th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let row of leaves;">
                <td>{{ row.leaveType }}</td>
                <td>{{ row.reason }}</td>
                <td>{{ row.status | titlecase }}</td>
                <td>{{ row.startDate }}</td>
                <td>{{ row.endDate }}</td>
                <td>{{ row.approvedAt | formatDate }}</td>
                <td class="text-center">
                  <a (click)="openModalEdit(editLeave, row.id)" title="Update">
                    <i class="bi bi-pencil action-icon"></i>
                  </a>
                  <a (click)="delete(row.id)" title="Delete">
                    <i class="bi bi-trash action-icon"></i>
                  </a>
                  <a (click)="updateStatus(row.id, LeaveStatus.APPROVED)" title="Approve"
                     *ngIf="row.status===LeaveStatus.PENDING && resourceId!==loggedUserId">
                    <i class="bi bi-hand-thumbs-up action-icon"></i>
                  </a>
                  <a (click)="updateStatus(row.id, LeaveStatus.REJECTED)" title="Reject"
                     *ngIf="row.status===LeaveStatus.PENDING  && resourceId!==loggedUserId">
                    <i class="bi bi-hand-thumbs-down action-icon"></i>
                  </a>
                </td>
              </tr>
              </tbody>
            </table>
          </div>
<!--
          <div class="table-responsive w-100" style="width: 100%; overflow-x: auto;">
            <ngx-datatable
              [rows]="leaves"
              [columnMode]="'force'"
              [headerHeight]="40"
              [footerHeight]="30"
              [rowHeight]="'auto'"
              [sorts]="[{ prop: 'leaveType', dir: 'asc' }]"
              class="bootstrap"
            >
          <ngx-datatable-column name="Type" prop="leaveType" [sortable]="true"></ngx-datatable-column>
          <ngx-datatable-column name="Reason" prop="reason"></ngx-datatable-column>
          <ngx-datatable-column name="Status" prop="status" ></ngx-datatable-column>
          <ngx-datatable-column name="Start Date" prop="startDate" [sortable]="true"></ngx-datatable-column>
          <ngx-datatable-column name="End Date" prop="endDate" [sortable]="true"></ngx-datatable-column>
          <ngx-datatable-column name="Approved At" prop="approvedAt" [sortable]="true">

            <ng-template let-row="row" ngx-datatable-cell-template>
              {{ row.approvedAt | formatDate }}
            </ng-template>

          </ngx-datatable-column>
          <ngx-datatable-column name="Action">
            <ng-template let-row="row" ngx-datatable-cell-template>
              <a (click)="openModalEdit(editLeave, row.id)" title="Update">
                <i class="bi bi-pencil action-icon"></i>
              </a>
              <a (click)="delete(row.id)" title="Delete">
                <i class="bi bi-trash action-icon"></i>
              </a>
              <a (click)="updateStatus(row.id, LeaveStatus.APPROVED)" title="Approve"
              *ngIf="row.status===LeaveStatus.PENDING && resourceId!==loggedUserId">
                <i class="bi bi-hand-thumbs-up action-icon"></i>
              </a>
              <a (click)="updateStatus(row.id, LeaveStatus.REJECTED)" title="Reject"
                 *ngIf="row.status===LeaveStatus.PENDING  && resourceId!==loggedUserId">
                <i class="bi bi-hand-thumbs-down action-icon"></i>
              </a>

            </ng-template>
          </ngx-datatable-column>
        </ngx-datatable>
          </div>-->
        </div>
        <div class="text-center mt-2 d-flex justify-content-center gap-2 mt-2 mb-3">
          <button class="btn btn-primary w-20" (click)="openModal(editLeave)">Apply Leave</button>
          <button class="btn btn-secondary w-20" (click)="closeDialog()">Close</button>
        </div>
      </div>
    </div>
  </div>
  <ng-template #editLeave>
    <div class="modal fade show d-block">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add/Update Leave</h5>
            <button type="button" class="btn-close" (click)="closeModal()"></button>
          </div>
          <div class="modal-body">
            <form  #resourceForm="ngForm" >
              <div class="mb-3">
                <label class="form-label">Type<span class="text-danger ms-1">*</span></label>
                <select name="leaveType"  [(ngModel)]="leave.leaveType" class="form-control" required
                        #leaveType="ngModel"
                        [ngClass]="{ 'is-invalid': leaveType.invalid && (leaveType.dirty || leaveType.touched) }"
                        [showErrors]="{ required: 'Type is required' }">
                  <option *ngFor="let scope of leaveTypes" [value]="scope.viewValue">
                    {{ scope.value }}
                  </option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Reason<span class="text-danger ms-1">*</span></label>
                <textarea type="text" class="form-control" [(ngModel)]="leave.reason" name="reason" required
                          #reason="ngModel"
                          [ngClass]="{ 'is-invalid': reason.invalid && (reason.dirty || reason.touched) }"
                          [showErrors]="{ required: 'Reason is required' }">
                  </textarea>
              </div>
              <div class="mb-3" *ngIf="leave.id>0 && leave.resourceId != loggedUserId">
                <label class="form-label">Status<span class="text-danger ms-1">*</span></label>
                <select name="status"  [(ngModel)]="leave.status" class="form-control" required
                        #status="ngModel"
                        [ngClass]="{ 'is-invalid': status.invalid && (status.dirty || status.touched) }"
                        [showErrors]="{ required: 'Status is required' }">
                  <option *ngFor="let scope of leaveStatuses" [value]="scope.viewValue">
                    {{ scope.value }}
                  </option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Start Date<span class="text-danger ms-1">*</span></label>
                <input type="date" class="form-control" [(ngModel)]="leave.startDate" name="startDate" required
                       #startDate="ngModel"
                       [ngClass]="{ 'is-invalid': startDate.invalid && (startDate.dirty || startDate.touched) }"
                       [showErrors]="{ required: 'Start Date is required' }">
              </div>
              <div class="mb-3">
                <label class="form-label">End Date<span class="text-danger ms-1">*</span></label>
                <input type="date" class="form-control" [(ngModel)]="leave.endDate" name="endDate" required
                       #endDate="ngModel"
                       [ngClass]="{ 'is-invalid': endDate.invalid && (endDate.dirty || endDate.touched) }"
                       [showErrors]="{ required: 'End Date is required' }">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button class="btn btn-success w-20" (click)="update()" *ngIf="leave.id>0" [disabled]="resourceForm.invalid">Update</button>
            <button class="btn btn-success w-20" (click)="add()" *ngIf="leave.id===0" [disabled]="resourceForm.invalid">Add</button>
            <button class="btn btn-secondary w-20" (click)="closeModal()">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
</div>
