<div class="container mt-4">
  <div class="card shadow-lg">
    <div class="card-header bg-primary text-white text-center">
      <h3>Leaves for {{resource!.name}}</h3>
    </div>
    <div class="card-body">
      <div class="table-container">

  <ngx-datatable
    [rows]="leaves"
    [columnMode]="'force'"
    [headerHeight]="50"
    [footerHeight]="50"
    [rowHeight]="'auto'"
    [sorts]="[{ prop: 'priorityLevel', dir: 'asc' }]"
    class="material">

    <ngx-datatable-column name="Type" prop="leaveType" [sortable]="true"></ngx-datatable-column>
    <ngx-datatable-column name="Reason" prop="reason" ></ngx-datatable-column>
    <ngx-datatable-column name="Status" prop="status" ></ngx-datatable-column>
    <ngx-datatable-column name="Start Date" prop="startDate" [sortable]="true"></ngx-datatable-column>
    <ngx-datatable-column name="End Date" prop="endDate" [sortable]="true"></ngx-datatable-column>
    <ngx-datatable-column name="Approved At" prop="approvedAt" [sortable]="true"></ngx-datatable-column>
    <ngx-datatable-column name="Action">
      <ng-template let-row="row" ngx-datatable-cell-template>
        <a (click)="openModalEdit(editLeave, row.id)" title="Update">
          <i class="bi bi-pencil action-icon"></i>
        </a>
        <a (click)="delete(row.id)" title="Delete">
          <i class="bi bi-trash action-icon"></i>
        </a>
        <a (click)="updateStatus(row.id, LeaveStatus.APPROVED)" title="Approve"
        *ngIf="row.status===LeaveStatus.PENDING && resourceId!==loggedUserId">
          <i class="bi bi-hand-thumbs-up action-icon"></i>
        </a>
        <a (click)="updateStatus(row.id, LeaveStatus.REJECTED)" title="Reject"
           *ngIf="row.status===LeaveStatus.PENDING  && resourceId!==loggedUserId">
          <i class="bi bi-hand-thumbs-down action-icon"></i>
        </a>

      </ng-template>
    </ngx-datatable-column>
  </ngx-datatable>
      </div>
    </div>
    <div class="text-center">
      <button class="btn btn-primary mb-3" (click)="openModal(editLeave)">Apply Leave</button>
      <button class="btn btn-secondary btn-sm" (click)="closeDialog()">Close</button>
    </div>
  </div>
  <ng-template #editLeave>
    <div class="modal fade show d-block">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add/Update Epic</h5>
            <button type="button" class="btn-close" (click)="closeModal()"></button>
          </div>
          <div class="modal-body">
            <form  #resourceForm="ngForm" >
              <div class="mb-3">
                <label class="form-label">Type</label><label class="required-label">&nbsp;* </label>
                <select name="leaveType"  [(ngModel)]="leave.leaveType" class="form-control" required
                        #leaveType="ngModel"
                        [ngClass]="{ 'is-invalid': leaveType.invalid && (leaveType.dirty || leaveType.touched) }"
                        [showErrors]="{ required: 'Type is required' }">
                  <option *ngFor="let scope of leaveTypes" [value]="scope.viewValue">
                    {{ scope.value }}
                  </option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Reason</label><label class="required-label">&nbsp;* </label>
                <textarea type="text" class="form-control" [(ngModel)]="leave.reason" name="reason" required
                          #reason="ngModel"
                          [ngClass]="{ 'is-invalid': reason.invalid && (reason.dirty || reason.touched) }"
                          [showErrors]="{ required: 'Reason is required' }">
                  </textarea>
              </div>
              <div class="mb-3" *ngIf="leave.id>0 && leave.resourceId != loggedUserId">
                <label class="form-label">Status</label><label class="required-label">&nbsp;* </label>
                <select name="status"  [(ngModel)]="leave.status" class="form-control" required
                        #status="ngModel"
                        [ngClass]="{ 'is-invalid': status.invalid && (status.dirty || status.touched) }"
                        [showErrors]="{ required: 'Status is required' }">
                  <option *ngFor="let scope of leaveStatuses" [value]="scope.viewValue">
                    {{ scope.value }}
                  </option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Start Date</label><label class="required-label">&nbsp;* </label>
                <input type="date" class="form-control" [(ngModel)]="leave.startDate" name="startDate" required
                       #startDate="ngModel"
                       [ngClass]="{ 'is-invalid': startDate.invalid && (startDate.dirty || startDate.touched) }"
                       [showErrors]="{ required: 'Start Date is required' }">
              </div>
              <div class="mb-3">
                <label class="form-label">End Date</label><label class="required-label">&nbsp;* </label>
                <input type="date" class="form-control" [(ngModel)]="leave.endDate" name="endDate" required
                       #endDate="ngModel"
                       [ngClass]="{ 'is-invalid': endDate.invalid && (endDate.dirty || endDate.touched) }"
                       [showErrors]="{ required: 'End Date is required' }">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
            <button class="btn btn-success" (click)="update()" *ngIf="leave.id>0" [disabled]="resourceForm.invalid">Update</button>
            <button class="btn btn-success" (click)="add()" *ngIf="leave.id===0" [disabled]="resourceForm.invalid">Add</button>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
</div>
